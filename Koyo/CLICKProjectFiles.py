# CLICKProjectFiles.py
# Copyright (C) 2021 Alex Holburn https://www.alexholburn.com
# See the file 'docs/LICENSE' for copying permission.

# Script Purpose: This script is a Cuckoo Sandbox signature designed to detect if CLICK
#                 generated files are being accessed. Malware exhibiting this behavior would
#                 be indicative of ICS Reconnaissance to determine if an engineering workstation
#                 or file repository is interacting with the CLICK automation platform/IDE
#                 Additionally it may indicate targeting specific filetypes for information
#                 theft/ransoming.

# I am looking to transition into Cybersecurity, contact me if you like my work.
# email: alex.holburn@alexholburn.com
# LinkedIn: https://www.linkedin.com/in/alex-holburn-88884b5b/
# Portfolio:  https://www.alexholburn.com


from lib.cuckoo.common.abstracts import Signature


class CLICKDetectProjectFile(Signature):
    name = "CLICK_detectProjectFile"
    description = "Attempts to Access CLICK Project Files"
    severity = 2
    categories = ["Koyo ICS Reconnaissance"]
    authors = ["Alex Holburn"]
    minimum = "2.0"
    ttp = ["T0811"]


file_indicators = [
        ".*\\.ckp$",      # CLICK Project File extension.
    ]


def on_complete(self):
    for indicator in self.file_indicators:
        for match in self.check_file(pattern=indicator, regex=True, all=True):
            self.mark_ioc("file", match)

        return self.has_marks()
