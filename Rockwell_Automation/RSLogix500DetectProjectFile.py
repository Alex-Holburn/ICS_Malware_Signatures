# RSLogix500DetectProjectFile.py
# Copyright (C) 2021 Alex Holburn https://www.alexholburn.com
# See the file 'docs/LICENSE' for copying permission.

# Script Purpose: This script is a Cuckoo Sandbox signature designed to detect is RSLogix 500
#                 generated files are being accessed. Malware exhibiting this
#                 behavior would be indicative of ICS Reconnaissance to determine if an engineering
#                 workstation or file repository is interacting with the SLC or MicroLogix
#                 PLC platform. Additionally it may indicate targeting specific filetypes for information
#                 theft/ransoming.

# I am looking to transition into Cybersecurity, contact me if you like my work.
# email: alex.holburn@alexholburn.com
# LinkedIn: https://www.linkedin.com/in/alex-holburn-88884b5b/
# Portfolio:  https://www.alexholburn.com


from lib.cuckoo.common.abstracts import Signature


class RSLogix5KDetectProjectFile(Signature):
    name = "RSLogix500_detectProjectFile"
    description = "Attempts to Access RSLogix 500 Project Files"
    severity = 2
    categories = ["Rockwell Automation ICS Reconnaissance"]
    authors = ["Alex Holburn"]
    minimum = "2.0"
    ttp = ["T0811"]


file_indicators = [
        ".*\\.ACH$",      # RSLogix 500 SLC 500 Archive File extension
        ".*\\.ADA$",      # RSLogix 500 Database Address File extension
        ".*\\.AID$",      # RSLogix 500 Database Address Internal Key File extension
        ".*\\.CTD$",      # RSLogix 500 Database Control File extension
        ".*\\.CTI$",      # RSLogix 500 Index for Database Control File extension
        ".*\\.DAT$",      # RSLogix 500 Database Lock File extension
        ".*\\.EAS$",      # RSLogix 500 Exported Symbol/Description File extension
        ".*\\.EIC$",      # RSLogix 500 Exported Instruction Comment File extension
        ".*\\.ERP$",      # RSLogix 500 Exported Page Title/Rung Description File extension
        ".*\\.ESG$",      # RSLogix 500 Exported Symbol Group File extension
        ".*\\.IDA$",      # RSLogix 500 Database Instruction File extension
        ".*\\.IID$",      # RSLogix 500 Database Instruction Internal Key File extension
        ".*\\.LOG$",      # RSLogix 500 Import/Export Procedure Results File extension
        ".*\\.NAM$",      # RSLogix 500 Subroutine Name(s) File extension
        ".*\\.RDA$",      # RSLogix 500 Database Rung File extension
        ".*\\.RID$",      # RSLogix 500 Database Rung Internal Key File extension
        ".*\\.RS1$",      # RSLogix 500 Compressed Format Backup File extension
        ".*\\.RSS$",      # RSLogix 500 Ladder Program File extension
        ".*\\.SGD$",      # RSLogix 500 Database Symbol/Group File extension
        ".*\\.SGI$",      # RSLogix 500 Database Symbol/Group Type Internal Key File extension
        ".*\\.SWD$",      # RSLogix 500 Device Code Index File extension
        ".*\\.UPL$",      # RSLogix 500 Uploaded Project Files File extension
        ".*\\.XDA$",      # RSLogix 500 Database Cross-Reference File extension
        ".*\\.XID$",      # RSLogix 500 Database Cross-Reference Internal Key File extension
    ]


def on_complete(self):
    for indicator in self.file_indicators:
        for match in self.check_file(pattern=indicator, regex=True, all=True):
            self.mark_ioc("file", match)

        return self.has_marks()
